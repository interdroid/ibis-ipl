<project
    name="gmi-app"
    default="build"
    basedir=".">

    <import file="${ibis}/build-files/build-properties.xml"/>
    <import file="${ibis}/build-files/apps/build-run.xml"/>

    <description>
	Ibis gmi application build.
    </description>

    <target name="property-gmi-build" unless="build">
	<echo message="build is undefined. Set it to the default value"/>
	<property name="build" location="build"/>
    </target>

    <target name="gmi-init"
	    depends="property-gmi-build,property-init"/>

    <target name="gmi"
	    depends="gmi-init">
	    <!-- commented out description
	    description="Preprocess GMI class files in the build tree"
	    -->
	<java   classname="ibis.frontend.ibis.Ibisc"
		taskname="Ibisc"
		failonerror="true"
		dir="${build}"
		fork="true">
		<arg line="-gmi ."/>
	    <classpath refid="default.classpath"/>
	</java>
    </target>

    <target name="init" depends="property-init">
	<tstamp/>
	<mkdir dir="${build}"/>
	<!--
	<echo message="os.name = ${os.name} os.arch = ${os.arch}"/>
	<echo message="user.name = ${user.name} user.dir = ${user.dir}"/>
	<echo message="java.ext.dirs = ${java.ext.dirs}"/>
	-->
    </target>

    <target name="compile"
	    depends="clean,init,property-init">
	<javac  destdir="${build}"
		debug="true"
		srcdir=".">
	    <classpath refid="default.classpath"/>
	    <include name="*.java"/>
	</javac>
    </target>

    <target name="build"
	    depends="init"
	    description="Compile a GMI program">
	<antcall target="compile"/>
	<antcall target="gmi"/>
    </target>

    <target name="clean"
	    description="Clean up the build">
	<delete dir="${build}"/>
    </target>

</project>
