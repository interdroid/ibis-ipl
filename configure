#!/bin/sh

. configuration.sh

if [ -f config.mk ]
then
	cp config.mk config.mk.old
fi

if [ -f config.mk.orig ]
then
	diff -c config.mk.orig config.mk > .config.mk.diff
else
	rm -f .config.mk.diff
fi

sed -e "
s+@JAVA_ROOT@+$JAVA_ROOT+
s+@JAVAC@+$JAVAC+
s+@IBIS_ROOT@+$IBIS_ROOT+
s+@MANTA_ROOT@+$MANTA_ROOT+
s+@PANDA_ROOT@+$PANDA_ROOT+
s+@LFC_ROOT@+$LFC_ROOT+
s+@GM_ROOT@+$GM_ROOT+
s+@DAS_LIB@+$DAS_LIB+
s+@PANDA_NETWORK@+$PANDA_NETWORK+
s+@BCEL@+$BCEL+
" < src/scripts/config.in > config.mk

cp config.mk config.mk.orig
if [ -f .config.mk.diff ]
then
	patch -p0 < .config.mk.diff
	rm .config.mk.diff
fi

(cd src/ibis/util; make CFLAGS=-g getpid java_wrapper)
cp src/ibis/util/getpid bin/
cp src/ibis/util/java_wrapper bin/
