<project
    name="properties"
    default="property-init"
    basedir=".">

    <description>
	Properties to be shared by all files, apps in Ibis

	Requires prior definition of the following properties:

	    ibis          the root of the Ibis tree

	Optional prior property definition:

	    build         the root of the build tree


	Specify in this file:

	    package.home.ant-cpptasks	root of ant-cpptasks
	    package.home.ant-contrib	root of ant-contrib
	    package.home.bcel		root of bcel

	    property optimization is one of
		optimize
		debug

	    property c.compiler is one from the list in cpp-tasks cc.
	    Suggestions:
		gcc			if unix
		msvc or bcc		if windows
    </description>


    <target name="property-init"
	    depends="property-init-once"
	    unless="property.initialized">
	<property name="property.initialized" value="true"/>
    </target>


    <target name="property-init-once"
	    depends="property-config-init,property-compiler-init,contrib-init,proprietary-tasks">
    </target>


    <target name="property-config-init">
	<!--
	    Defines shared by all projects under ibis
	-->

	<property file="${ibis}/build-properties"/>

	<property environment="env"/>
	<property name="JAVA_HOME"    value="${env.JAVA_HOME}"/>

	<property name="ibisBuild"   location="${ibis}/build"/>
    </target>


    <target name="property-compiler-init"
	    depends="property-config-init,contrib-init">

	<path id="default.classpath">
	    <pathelement path="${ibisBuild}"/>
	    <pathelement path="${build}"/>
	    <pathelement path="${package.home.bcel-additions}"/>
	    <pathelement path="${package.home.bcel}"/>
	</path>

	<echo message="Now set default.classpath to ${default.classpath}"/>

	<!--
	    Choose a value from
		debug
		optimize
	<property name="optimization" value="optimize"/>
	<property name="optimization" value="debug"/>
	-->
	<property name="optimization" value="optimize"/>

	<!--
	    If you want debug info in java or native, define these properties.
	    It is only relevant whether they are defined - - giving them the
	    value "true" has the same effect as giving them the value "false".
	    To avoid debug info, just comment out the following two lines.
	-->
	<!--
	-->
	<property name="java.debug" value="true"/>
	<property name="native.debug" value="true"/>

	<if>
	    <equals arg1="${optimization}" arg2="optimize"/>
	    <then>
		<property name="java.optimize" value="true"/>
		<property name="java.optimize.value" value="true"/>
		<property name="native.optimize" value="true"/>
		<property name="native.optimize.value" value="true"/>
	    </then>
	    <else>
		<!-- The tric is to NOT set native.optimize or java.optimize -->
		<property name="java.optimize.value" value="false"/>
		<property name="native.optimize.value" value="false"/>
	    </else>
	</if>
	<if>
	    <isset property="java.debug"/>
	    <then>
		<property name="java.debug.value" value="true"/>
	    </then>
	    <else>
		<property name="java.debug.value" value="false"/>
	    </else>
	</if>
	<if>
	    <isset property="native.debug"/>
	    <then>
		<property name="native.debug.value" value="true"/>
	    </then>
	    <else>
		<property name="native.debug.value" value="false"/>
	    </else>
	</if>

	<!--
	    Choose the C compiler of your liking.
	    Override if you are not content with the default.
	-->
	<if>
	    <os family="unix"/>
	    <then>
		<property name="c.compiler" value="gcc"/>
		<property name="optimize.arg" value="-O3"/>
	    </then>
	<elseif>
	    <os family="windows"/>
	    <then>
		<property name="c.compiler" value="bcc"/>
		<property name="optimize.arg" value="-O2"/>
	    </then>
	</elseif>
	<elseif>
	    <os family="mac"/>
	    <then>
		<property name="c.compiler" value="gcc"/>
		<property name="optimize.arg" value="-O3"/>
	    </then>
	</elseif>
	</if>
    </target>


    <target name="contrib-init"
	    depends="property-config-init">
	<echo level="verbose"
		message="ant-contrib home is ${package.home.ant-contrib}"/>
	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
	    <classpath>
		<pathelement location="${package.home.ant-contrib}"/>
	    </classpath>
	</taskdef>
    </target>


    <target name="proprietary-tasks"
	    depends="property-config-init">
	<mkdir dir="${ibis}/ant-tasks/tasks"/>
	<javac
		srcdir="${ibis}/ant-tasks"
		destdir="${ibis}/ant-tasks/tasks">
	    <include name="**/*.java"/>
	    <classpath refid="default.classpath"/>
	</javac>
	<taskdef
		name="maplibrary"
		classname="MapLibraryName"
		classpath="${ibis}/ant-tasks/tasks"/>
	<taskdef
		name="hostname"
		classname="HostName"
		classpath="${ibis}/ant-tasks/tasks"/>
    </target>



    <!--
	Auxilliary target to run applications from ant
    -->
    <target name="run" depends="property-init">
	<property name="IBIS"      value="panda"/>
	<property name="SER"       value="ibis"/>
	<property name="HOSTS"     value="2"/>
	<property name="HOSTNAMES" value="athlon-win2000 p3"/>
	<exec outputproperty="hostname" executable="hostname"/>
	<echo message="My hostname is ${hostname}"/>
	<if>
	    <equals arg1="${hostname}" arg2="athlon-win2000"/>
	    <then>
		<property name="host.number" value="0"/>
	    </then>
	<elseif>
	    <equals arg1="${hostname}" arg2="p3"/>
	    <then>
		<property name="host.number" value="1"/>
	    </then>
	</elseif>
	</if>
	<java
		fork="true"
		classname="${MAIN}"
		classpath="build:${ibis}/build">
	    <sysproperty key="java.library.path"      value="${ibis}/build/lib"/>
	    <sysproperty key="ibis.name_server.host"  value="athlon-win2000"/>
	    <sysproperty key="ibis.name_server.port"  value="7654"/>
	    <sysproperty key="ibis.name_server.key"   value="rutger.0001"/>
	    <sysproperty key="ibis.pool.host_number"  value="${host.number}"/>
	    <sysproperty key="ibis.pool.total_hosts"  value="${HOSTS}"/>
	    <sysproperty key="ibis.pool.host_names"   value="${HOSTNAMES}"/>
	    <sysproperty key="ibis.name"              value="${IBIS}"/>
	    <sysproperty key="ibis.serialization"     value="${SER}"/>
	    <arg line="${ARGS}"/>
	</java>
    </target>

</project>
